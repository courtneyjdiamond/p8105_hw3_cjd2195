P8105 Homework 3
================
Courtney Diamond
2023-10-14

Let’s start by loading our libraries and creating some default settings.

## Question 1

Great. Let’s load our first dataset.

``` r
data("instacart")

instacart = 
  instacart |>
  as_tibble()
```

We are looking at a dataset of 1384617 observations and 15 variables,
all relating to orders from Instacart. The variables include:

- `order_id`: the unique identifier of the order
- `product_id`: the unique identifier of the product
- `add_to_cart_order`: the order in which the item was placed into the
  cart
- `reordered`: an indicator of whether or not the product is a repeat
  order
- `user_id`: a user’s unique identifier
- `eval_set`: whether the observation is part of a training or test set
  for some model
- `order_number`: for a specific user, the sequence of the whole order
  in relation to all orders made
- `order_dow`: which day of the week the order was placed
- `order_hour_of_day`: which hour of the day the order was placed
- `days_since_prior_order`: number of days since the user’s last order
- `product_name`: the human-readable product name
- `aisle_id`: the unique identifier of the aisle the product is in
- `department_id`: the unique identifier of the department the product
  is in
- `aisle`: the human-readable name of the aisle the product is in
- `department`: the human-readable name of the department the product is
  in

Each individual line or observations corresponds to a specific product
in a specific order by a specific user, and contains additional details
about the order and product. Let’s walk through the first line.
`order_id` is 1; this represents a single order by a single user, and is
the only order in the dataset with this ID. `product_id` is the product
in question; the corresponding human-readable name is in the
`product_name` column. The `add_to_cart_order` tells us that this
product was the very first thing the person put in their cart when
building this order, and `reordered` tells us whether or not the person
ordered the product before (in this case, yes). The `user_id` is 112108;
all of this person’s orders and products will have this value.
`eval_set` doesn’t give us information about the order or product, but
rather what the downstream use of the observation is for: in this case,
it will be part of the end-user’s training set for a given ML or other
model. `order_number` tells us that this is the fourth order for this
individual user, and `order_dow` tells us which day of the week the
order was placed on (but there’s no data to tell us which day the 4th
day of the week is, so it’s a little hard to interpret).
`order_hour_of_day` tells us they ordered this sometime between 10AM and
11AM (presuming they’re using standard military time). We can see that
there have been 9 days since the user’s last order, as indicated by the
`days_since_prior_order` column. We’ve already covered that the
`product_name` is the human readable version of the `product_id`, so in
this case we’re looking at some Bulgarian yogurt; `aisle_id` and
`department_id` tell us that this is found in a specific aisle and
department; the corresponding `aisle` and `department` variables tell us
in human-readable terms that we can find this product in the yogurt
aisle of the “dairy eggs” department.

Let’s do some tidying! I don’t think we need the `eval_set` variable
(the online description notes we are only working with training
observations here, and none of the questions I have pertain to this).
I’m also going to reorder so similar variables are grouped together, and
recode the `reordered` variable to “yes” and “no” to make it more
obvious to a human reader. I’ll hold off on recoding the `order_dow`
variable because there’s no definitive answer in the original README
file online about which number corresponds to which day.

``` r
tidy_instacart = 
instacart |> 
  select(!eval_set) |> 
  relocate(order_id,
           user_id,
           order_number,
           order_dow,
           order_hour_of_day,
           days_since_prior_order,
           add_to_cart_order,
           reordered,
           product_id,
           product_name,
           aisle_id, aisle,
           department_id,
           department) |> 
  mutate(
    reordered = 
      case_match(
        reordered,
        1 ~ "yes",
        0 ~ "no"), 
    reordered = 
      as.factor(reordered))
```

First up, we want to know how many aisles there are. We can establish
this by calling `group_by(aisle_id)`, and figuring out how many groups
are consequently made. We end up with 134 aisles.

``` r
tidy_instacart |> 
  group_by(aisle_id) |> 
  n_groups()
```

    ## [1] 134

We also want to know which aisles have the most products ordered from
them! I am going to interpret this as raw counts represented by the
number of times a product is listed in the table, and NOT group by the
item itself as a conceptual level. (That is, if there are 1,000,000 rows
corresponding to 1 type of ice cream, I will count each of those
individually, and not simply as 1 product.) We end up with the fresh
vegetables aisle having the most products ordered (150609), followed by
the fresh fruits with 150473 products, and the packaged vegetables
fruits taking third place with 78493 products.

Great- now let’s graph it!

``` r
tidy_instacart |> 
  count(aisle) |> 
  filter(n > 10000) |> 
  mutate(aisle = 
           fct_reorder(aisle, n, desc)) |> 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(title = "Number of Products Ordered from Each Aisle")
```

<img src="p8105_hw3_cjd2195_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

Now we want to examine a few aisles more closely.

``` r
tidy_instacart |> 
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits") |> 
  count(aisle, product_name) |> 
  group_by(aisle) |> 
  arrange(desc(n)) |> 
  mutate(rank = min_rank(desc(n))) |> 
  filter(rank < 4) |> 
  select(!rank) |>  
  knitr::kable()
```

| aisle                      | product_name                                  |    n |
|:---------------------------|:----------------------------------------------|-----:|
| packaged vegetables fruits | Organic Baby Spinach                          | 9784 |
| packaged vegetables fruits | Organic Raspberries                           | 5546 |
| packaged vegetables fruits | Organic Blueberries                           | 4966 |
| baking ingredients         | Light Brown Sugar                             |  499 |
| baking ingredients         | Pure Baking Soda                              |  387 |
| baking ingredients         | Cane Sugar                                    |  336 |
| dog food care              | Snack Sticks Chicken & Rice Recipe Dog Treats |   30 |
| dog food care              | Organix Chicken & Brown Rice Recipe           |   28 |
| dog food care              | Small Dog Biscuits                            |   26 |

Now let’s look at a couple of specific products.

``` r
tidy_instacart |> 
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") |> 
  group_by(product_name, order_dow) |> 
  summarize(mean_hour = mean(order_hour_of_day)) |> 
  pivot_wider(names_from = order_dow,
              values_from = mean_hour) |> 
  knitr::kable()
```

    ## `summarise()` has grouped output by 'product_name'. You can override using the
    ## `.groups` argument.

| product_name     |        0 |        1 |        2 |        3 |        4 |        5 |        6 |
|:-----------------|---------:|---------:|---------:|---------:|---------:|---------:|---------:|
| Coffee Ice Cream | 13.77419 | 14.31579 | 15.38095 | 15.31818 | 15.21739 | 12.26316 | 13.83333 |
| Pink Lady Apples | 13.44118 | 11.36000 | 11.70213 | 14.25000 | 11.55172 | 12.78431 | 11.93750 |

## Question 2

First up: loading and cleaning data!

``` r
data("brfss_smart2010")

brfss_df = brfss_smart2010 |> 
  as_tibble()

tidy_brfss = 
  brfss_df |> 
  janitor::clean_names() |> 
  rename(location_abbr = locationabbr,
         location_desc = locationdesc,
         ) |> 
  filter(topic == "Overall Health") |> 
  mutate(response =
           forcats::fct_relevel(response, c("Poor", "Fair", "Good", "Very good", "Excellent")))
```

``` r
tidy_brfss |> 
  filter(year == 2002) |> 
  count(location_abbr) |> 
  filter(n >= (5*7)) |> 
  nrow()  
```

    ## [1] 6

In 2002, only 6 states had more than 7 locations polled. This compares
to 14 states in 2010.

``` r
tidy_brfss |> 
  filter(response == "Excellent") |> 
  group_by(year, location_abbr) |> 
  summarize(n = n(), average_state_prevalence = mean(data_value)) |> 
  ggplot(aes(x = year, y = average_state_prevalence, color = fct_reorder(location_abbr, average_state_prevalence))) +
  geom_line() + 
  labs(
    title = "Average Percentage of Self-Reported Excellent Health by State, 2002-2010",
    x = "Year",
    y = "Prevalence",
    color = "State"
  ) + 
  theme(plot.title = element_text(size = 12), plot.title.position = "plot")
```

    ## `summarise()` has grouped output by 'year'. You can override using the
    ## `.groups` argument.

<img src="p8105_hw3_cjd2195_files/figure-gfm/unnamed-chunk-9-1.png" width="90%" />

``` r
tidy_brfss |> 
  filter(year == 2006 | year == 2010) |> 
  filter(location_abbr == "NY") |> 
  group_by(year, response) |> 
  ggplot(aes(x = data_value, fill = response)) +
  geom_density(alpha = .5) +
  facet_grid(.~year) + 
  labs(
    title = "Distributions of Overall Health Responses Among NY Locations, 2006 and 2010",
    x = "Reported Percentage",
    y = "Density"
  ) +
  theme(plot.title = element_text(size = 12), plot.title.position = "plot")
```

<img src="p8105_hw3_cjd2195_files/figure-gfm/unnamed-chunk-10-1.png" width="90%" />

``` r
tidy_brfss |> 
  filter(year == 2006 | year == 2010) |> 
  filter(location_abbr == "NY") |> 
  group_by(year, response) |> 
  ggplot(aes(x = response, y = data_value)) +
  geom_boxplot() +
  facet_grid(.~year) +
  labs(
    title = "Distributions of Overall Health Responses Among NY Locations, 2006 and 2010",
    x = "Response",
    y = "Reported Percentage"
  ) + 
  theme(plot.title = element_text(size = 12), plot.title.position = "plot")
```

<img src="p8105_hw3_cjd2195_files/figure-gfm/unnamed-chunk-10-2.png" width="90%" />
